# 系统架构设计

## 整体架构

### 分层架构
系统采用经典的三层架构设计:
1. 表现层(Controller)
   - 处理HTTP请求响应
   - 参数校验
   - 权限控制
   
2. 业务层(Service)
   - 业务逻辑处理
   - 事务管理
   - 数据校验
   
3. 数据访问层(Mapper)
   - 数据库操作
   - SQL执行
   - 结果映射

### 核心模块
```
project/
├── config/          # 配置模块
├── controller/      # 控制器
├── service/         # 服务层
│   ├── impl/       # 服务实现
│   └── base/       # 基础服务
├── mapper/         # 数据访问层
├── model/          # 数据模型
└── common/         # 公共组件
```

## 核心流程

### 1. 请求处理流程
```
HTTP请求 -> 
  拦截器(JWT验证) -> 
    控制器(参数校验) -> 
      服务层(业务处理) -> 
        数据访问层(SQL执行) ->
          配置表驱动
```

### 2. 数据校验流程
```
请求数据 ->
  配置加载(column_check_property) ->
    规则解析 ->
      校验执行 ->
        结果返回
```

### 3. SQL构建流程
```
查询请求 ->
  配置读取(table_attribute) ->
    字段配置(column_attribute) ->
      动态SQL构建 ->
        MyBatis执行
```

## 核心类设计

### 1. BaseController
基础控制器,提供:
- 统一响应处理
- 异常处理
- 参数校验

### 2. BaseService
基础服务类,提供:
- 通用CRUD操作
- 数据校验
- 事务管理

### 3. CommonMapper
通用数据访问接口:
- 动态SQL支持
- 结果映射
- 批量操作

## 关键组件

### 1. JWT认证
- 用户登录获取token
- 请求携带token认证
- token过期处理

### 2. 动态SQL构建器
- SELECT语句构建
- WHERE条件组装
- 参数绑定处理

### 3. 数据校验引擎
- 规则配置加载
- 校验规则执行
- 错误信息处理

## 扩展机制

### 1. 拦截器扩展
可通过实现HandlerInterceptor接口添加:
- 新的认证方式
- 日志记录
- 性能监控

### 2. 校验规则扩展
通过配置表添加新的校验规则:
- 自定义校验模式
- 复杂业务规则
- 跨表关联校验

### 3. SQL扩展
通过XML配置扩展SQL:
- 自定义查询
- 复杂连接
- 特殊函数

## 性能设计

### 1. 缓存策略
- 配置信息缓存
- 查询结果缓存
- 会话信息缓存

### 2. 数据库优化
- 索引设计
- SQL优化
- 连接池管理

### 3. 并发处理
- 线程池管理
- 事务隔离
- 锁机制

## 安全设计

### 1. 认证授权
- JWT token验证
- 角色权限控制
- 会话管理

### 2. 数据安全
- 敏感数据加密
- SQL注入防护
- XSS防护

### 3. 审计日志
- 操作日志记录
- 异常日志记录
- 性能日志记录 